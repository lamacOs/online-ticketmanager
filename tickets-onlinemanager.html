<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TicketShows</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    #app {
      position: relative;
    }

    .plus-button {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 28px;
      background: orange;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
    }

    .modal {
      position: fixed;
      width: 300px;
      height: 200px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      z-index: 10;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease;
    }

    .modal.open {
      transform: translate(-50%, -50%) scale(1);
    }

    .modal h3 {
      margin: 0;
    }

    .modal input {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
    }

    .modal-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .modal-buttons button {
      padding: 8px 12px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .cancel {
      background: #ccc;
      color: #333;
    }

    .confirm {
      background: #007bff;
      color: white;
    }

    .confirm.disabled {
      background: #aaa;
      cursor: not-allowed;
    }

    .show {
      background: white;
      padding: 12px;
      border-radius: 6px;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .show-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .ticket-list {
      margin-top: 10px;
      padding-left: 20px;
    }

    .ticket {
      margin: 5px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ticket.strikethrough {
      text-decoration: line-through;
      color: gray;
    }

    .ticket button {
      font-size: 12px;
      padding: 4px 8px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Online Ticket Manager</h1>
  <div id="app">
    <button class="plus-button" onclick="openModalStep(1)">＋</button>
    <div id="modal" class="modal">
      <h3 id="modal-question">Wann?</h3>
      <input type="text" id="modal-input" oninput="handleInput()" />
      <div class="modal-buttons">
        <button class="cancel" onclick="closeModal()">Abbrechen</button>
        <button id="confirm-button" class="confirm disabled" disabled onclick="handleNext()">Weiter</button>
      </div>
    </div>
    <div id="show-list"></div>
  </div>

  <script>
    let step = 1;
    let currentShow = {};
    let shows = [];
    let expandedShow = null;

    function openModalStep(s) {
      step = s;
      currentShow = {};
      document.getElementById('modal').classList.add('open');
      updateModal();
    }

    function updateModal() {
      const question = document.getElementById('modal-question');
      const input = document.getElementById('modal-input');
      const button = document.getElementById('confirm-button');
      input.value = "";
      button.classList.add("disabled");
      button.disabled = true;

      if (step === 1) {
        question.innerText = "Wann?";
        button.innerText = "Weiter";
      } else if (step === 2) {
        question.innerText = "Wo?";
        button.innerText = "Weiter";
      } else if (step === 3) {
        question.innerText = "Euer Name?";
        button.innerText = "Speichern";
      }
    }

    function handleInput() {
      const input = document.getElementById('modal-input');
      const button = document.getElementById('confirm-button');
      if (input.value.trim()) {
        button.classList.remove("disabled");
        button.disabled = false;
      } else {
        button.classList.add("disabled");
        button.disabled = true;
      }
    }

    function handleNext() {
      const input = document.getElementById('modal-input');
      const value = input.value.trim();
      if (step === 1) currentShow.time = value;
      else if (step === 2) currentShow.place = value;
      else if (step === 3) {
        currentShow.name = value;
        currentShow.tickets = [];
        shows.push(currentShow);
        closeModal();
        renderShows();
        return;
      }
      step++;
      updateModal();
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('open');
    }

    function renderShows() {
      const container = document.getElementById('show-list');
      container.innerHTML = "";
      shows.forEach((show, index) => {
        const showDiv = document.createElement('div');
        showDiv.className = "show";
        const header = document.createElement('div');
        header.className = "show-header";
        const title = document.createElement('span');
        title.innerText = show.name;
        const arrow = document.createElement('span');
        arrow.innerText = expandedShow === index ? "⬇" : "➡";
        header.onclick = () => toggleShow(index);
        header.appendChild(title);
        header.appendChild(arrow);
        showDiv.appendChild(header);

        if (expandedShow === index) {
          const addTicket = document.createElement('div');
          addTicket.innerText = "Ticket hinzufügen";
          addTicket.style.cursor = "pointer";
          addTicket.style.color = "blue";
          addTicket.onclick = () => addTicketToShow(index);
          showDiv.appendChild(addTicket);

          const ticketList = document.createElement('div');
          ticketList.className = "ticket-list";
          show.tickets.forEach((ticket, tIndex) => {
            const ticketDiv = document.createElement('div');
            ticketDiv.className = "ticket" + (ticket.used ? " strikethrough" : "");
            ticketDiv.innerText = `Sitzplatz: ${ticket.seat} – Ort: ${show.place}, Zeit: ${show.time}`;
            
            const useBtn = document.createElement('button');
            useBtn.innerText = "Ticket benutzt";
            useBtn.onclick = () => {
              ticket.used = true;
              renderShows();
            };
            const delBtn = document.createElement('button');
            delBtn.innerText = "Ticket löschen";
            delBtn.onclick = () => {
              show.tickets.splice(tIndex, 1);
              renderShows();
            };
            ticketDiv.appendChild(useBtn);
            ticketDiv.appendChild(delBtn);
            ticketList.appendChild(ticketDiv);
          });
          showDiv.appendChild(ticketList);
        }

        container.appendChild(showDiv);
      });
    }

    function toggleShow(index) {
      expandedShow = expandedShow === index ? null : index;
      renderShows();
    }

    function addTicketToShow(index) {
      const seat = prompt("Welcher Sitzplatz?");
      if (seat && seat.trim()) {
        shows[index].tickets.push({ seat: seat.trim(), used: false });
        renderShows();
      }
    }
  </script>
</body>
</html>